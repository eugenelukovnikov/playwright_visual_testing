{"uid":"29bf3c7c995c955c","name":"test_homepage[chromium]","fullName":"globalclinic.su.test_globalclinic#test_homepage","historyId":"0ccb46ab079edb67496947a166778baa","time":{"start":1752372744975,"stop":1752372839863,"duration":94888},"status":"failed","statusMessage":"Failed: Screenshots differ by 3743 pixels","statusTrace":"screenshot_helper = <conftest.screenshot_helper.<locals>.ScreenshotHelper object at 0x7f05a6518040>\npage = <Page url='https://globalclinic.su/'>\nscrolled_page = <function scrolled_page.<locals>._scrolled_page at 0x7f05a66d2d40>\n\n    def test_homepage(screenshot_helper, page, scrolled_page):\n    \n        slider = \"\"\"\n            const swipers = document.querySelectorAll('.swiper.hero-slider');\n            swipers.forEach(el => {\n                const swiperInstance = el.swiper;\n                if (swiperInstance && swiperInstance.autoplay) {\n                    swiperInstance.autoplay.stop();\n                }\n            });\n        \"\"\"\n    \n        widgets_selectors=[\n                \"//div[@class='medflex-round-widget']\",\n                \"//section[contains(@class, 'r52-a-cookies')]\"\n            ]\n    \n        scrolled_page(\"https://globalclinic.su/\", slider_stop=slider, widgets_delete = widgets_selectors)\n    \n    \n>       screenshot_helper.take_and_compare(\"homepage\")\n\nglobalclinic.su/test_globalclinic.py:23: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <conftest.screenshot_helper.<locals>.ScreenshotHelper object at 0x7f05a6518040>\nname = 'homepage', full_page = True, threshold = 0.1\n\n    def take_and_compare(self, name: str, full_page=True, threshold=0.1):\n        \"\"\"Сравнивает текущий скриншот с эталонным\"\"\"\n        if is_screenshots_update():\n            self.capture_screenshot(name, full_page)\n            pytest.skip(\"Updating reference screenshots\")\n    \n        reference_path = os.path.join(\n            self.reference_dir, self._get_filename(name, \"reference\"))\n        actual_path = os.path.join(\n            self.actual_dir, self._get_filename(name, \"actual\"))\n        diff_path = os.path.join(\n            self.diff_dir, self._get_filename(name, \"diff\"))\n    \n        # Делаем текущий скриншот\n        page.screenshot(path=actual_path, full_page=full_page)\n        allure.attach.file(actual_path, name=\"Actual: \" + name,\n                           attachment_type=AttachmentType.PNG)\n    \n        # Проверяем существование эталонного скриншота\n        if not os.path.exists(reference_path):\n            pytest.fail(\n                f\"Reference screenshot not found: {reference_path}\")\n    \n        # Загружаем изображения для сравнения\n        img_ref = Image.open(reference_path)\n        img_actual = Image.open(actual_path)\n        allure.attach.file(reference_path, name=\"Reference: \" + name,\n                           attachment_type=AttachmentType.PNG)\n    \n        # Проверяем совпадение размеров\n        if img_ref.size != img_actual.size:\n            pytest.fail(\n                f\"Screenshot sizes differ: {img_ref.size} vs {img_actual.size}\")\n    \n        # Сравниваем изображения\n        diff_img = Image.new(\"RGBA\", img_ref.size)\n        mismatch = pixelmatch(\n            img_ref,\n            img_actual,\n            diff_img,\n            threshold=threshold,\n            includeAA=False\n        )\n    \n        # Если есть различия - сохраняем diff\n        if mismatch > 0:\n            diff_img.save(diff_path)\n            allure.attach.file(diff_path, name=\"Diff: \" + name,\n                               attachment_type=AttachmentType.PNG)\n>           pytest.fail(f\"Screenshots differ by {mismatch} pixels\")\nE           Failed: Screenshots differ by 3743 pixels\n\nconftest.py:139: Failed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"pytestconfig","time":{"start":1752372744455,"stop":1752372744455,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"base_url","time":{"start":1752372744455,"stop":1752372744455,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_verify_url","time":{"start":1752372744455,"stop":1752372744455,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"playwright","time":{"start":1752372744455,"stop":1752372744671,"duration":216},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"delete_output_dir","time":{"start":1752372744455,"stop":1752372744455,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"launch_browser","time":{"start":1752372744672,"stop":1752372744672,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_type","time":{"start":1752372744672,"stop":1752372744672,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser","time":{"start":1752372744672,"stop":1752372744925,"duration":253},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_type_launch_args","time":{"start":1752372744672,"stop":1752372744672,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"device","time":{"start":1752372744926,"stop":1752372744926,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_context_args","time":{"start":1752372744926,"stop":1752372744926,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_pw_artifacts_folder","time":{"start":1752372744926,"stop":1752372744926,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_artifacts_recorder","time":{"start":1752372744927,"stop":1752372744927,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"context","time":{"start":1752372744927,"stop":1752372744936,"duration":9},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"new_context","time":{"start":1752372744927,"stop":1752372744927,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"page","time":{"start":1752372744936,"stop":1752372744973,"duration":37},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"screenshot_helper","time":{"start":1752372744973,"stop":1752372744974,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"scrolled_page","time":{"start":1752372744974,"stop":1752372744974,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"status":"failed","statusMessage":"Failed: Screenshots differ by 3743 pixels","statusTrace":"screenshot_helper = <conftest.screenshot_helper.<locals>.ScreenshotHelper object at 0x7f05a6518040>\npage = <Page url='https://globalclinic.su/'>\nscrolled_page = <function scrolled_page.<locals>._scrolled_page at 0x7f05a66d2d40>\n\n    def test_homepage(screenshot_helper, page, scrolled_page):\n    \n        slider = \"\"\"\n            const swipers = document.querySelectorAll('.swiper.hero-slider');\n            swipers.forEach(el => {\n                const swiperInstance = el.swiper;\n                if (swiperInstance && swiperInstance.autoplay) {\n                    swiperInstance.autoplay.stop();\n                }\n            });\n        \"\"\"\n    \n        widgets_selectors=[\n                \"//div[@class='medflex-round-widget']\",\n                \"//section[contains(@class, 'r52-a-cookies')]\"\n            ]\n    \n        scrolled_page(\"https://globalclinic.su/\", slider_stop=slider, widgets_delete = widgets_selectors)\n    \n    \n>       screenshot_helper.take_and_compare(\"homepage\")\n\nglobalclinic.su/test_globalclinic.py:23: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <conftest.screenshot_helper.<locals>.ScreenshotHelper object at 0x7f05a6518040>\nname = 'homepage', full_page = True, threshold = 0.1\n\n    def take_and_compare(self, name: str, full_page=True, threshold=0.1):\n        \"\"\"Сравнивает текущий скриншот с эталонным\"\"\"\n        if is_screenshots_update():\n            self.capture_screenshot(name, full_page)\n            pytest.skip(\"Updating reference screenshots\")\n    \n        reference_path = os.path.join(\n            self.reference_dir, self._get_filename(name, \"reference\"))\n        actual_path = os.path.join(\n            self.actual_dir, self._get_filename(name, \"actual\"))\n        diff_path = os.path.join(\n            self.diff_dir, self._get_filename(name, \"diff\"))\n    \n        # Делаем текущий скриншот\n        page.screenshot(path=actual_path, full_page=full_page)\n        allure.attach.file(actual_path, name=\"Actual: \" + name,\n                           attachment_type=AttachmentType.PNG)\n    \n        # Проверяем существование эталонного скриншота\n        if not os.path.exists(reference_path):\n            pytest.fail(\n                f\"Reference screenshot not found: {reference_path}\")\n    \n        # Загружаем изображения для сравнения\n        img_ref = Image.open(reference_path)\n        img_actual = Image.open(actual_path)\n        allure.attach.file(reference_path, name=\"Reference: \" + name,\n                           attachment_type=AttachmentType.PNG)\n    \n        # Проверяем совпадение размеров\n        if img_ref.size != img_actual.size:\n            pytest.fail(\n                f\"Screenshot sizes differ: {img_ref.size} vs {img_actual.size}\")\n    \n        # Сравниваем изображения\n        diff_img = Image.new(\"RGBA\", img_ref.size)\n        mismatch = pixelmatch(\n            img_ref,\n            img_actual,\n            diff_img,\n            threshold=threshold,\n            includeAA=False\n        )\n    \n        # Если есть различия - сохраняем diff\n        if mismatch > 0:\n            diff_img.save(diff_path)\n            allure.attach.file(diff_path, name=\"Diff: \" + name,\n                               attachment_type=AttachmentType.PNG)\n>           pytest.fail(f\"Screenshots differ by {mismatch} pixels\")\nE           Failed: Screenshots differ by 3743 pixels\n\nconftest.py:139: Failed","steps":[],"attachments":[{"uid":"123855f620c0b97d","name":"Actual: homepage","source":"123855f620c0b97d.png","type":"image/png","size":2294945},{"uid":"399a19002423aa3","name":"Reference: homepage","source":"399a19002423aa3.png","type":"image/png","size":2298437},{"uid":"7cccd21fe26e4884","name":"Diff: homepage","source":"7cccd21fe26e4884.png","type":"image/png","size":818617}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":3,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"new_context::0","time":{"start":1752372839871,"stop":1752372839884,"duration":13},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_artifacts_recorder::0","time":{"start":1752372839884,"stop":1752372839884,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser::0","time":{"start":1752373032579,"stop":1752373032622,"duration":43},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_pw_artifacts_folder::0","time":{"start":1752373032579,"stop":1752373032579,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"playwright::0","time":{"start":1752373032624,"stop":1752373032631,"duration":7},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"parentSuite","value":"globalclinic.su"},{"name":"suite","value":"test_globalclinic"},{"name":"host","value":"pkrvmq0rgcvqdmg"},{"name":"thread","value":"6496-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"globalclinic.su.test_globalclinic"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"browser_name","value":"'chromium'"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"tags":[]},"source":"29bf3c7c995c955c.json","parameterValues":["'chromium'"]}