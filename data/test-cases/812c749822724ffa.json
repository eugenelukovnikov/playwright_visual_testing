{"uid":"812c749822724ffa","name":"test_homepage[chromium]","fullName":"klinika-innomed.ru.test_klinika_innomed#test_homepage","historyId":"560207355e7dbdd8ee40345dc77e010b","time":{"start":1752372839925,"stop":1752372909503,"duration":69578},"status":"failed","statusMessage":"Failed: Screenshots differ by 284 pixels","statusTrace":"screenshot_helper = <conftest.screenshot_helper.<locals>.ScreenshotHelper object at 0x7f05a6417370>\npage = <Page url='https://klinika-innomed.ru/'>\nscrolled_page = <function scrolled_page.<locals>._scrolled_page at 0x7f05a66d3b50>\n\n    def test_homepage(screenshot_helper, page, scrolled_page):\n    \n        slider = \"\"\"\n            document.querySelectorAll('.owl-carousel').forEach(el => {\n                $(el).trigger('stop.owl.autoplay');\n            });\n            \"\"\"\n    \n        widgets_selectors = [\n            \"//div[@class='medflex-round-widget']\",\n            \"//div[contains(@class,'b24-widget-button-wrapper')]\"\n        ]\n    \n        # Загрузка + прокрутка вниз + удаление виджетов и остановка слайдера\n        scrolled_page(\"https://klinika-innomed.ru/\",\n                      slider_stop=slider, widgets_delete=widgets_selectors)\n    \n>       screenshot_helper.take_and_compare(\"homepage\")\n\nklinika-innomed.ru/test_klinika_innomed.py:21: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <conftest.screenshot_helper.<locals>.ScreenshotHelper object at 0x7f05a6417370>\nname = 'homepage', full_page = True, threshold = 0.1\n\n    def take_and_compare(self, name: str, full_page=True, threshold=0.1):\n        \"\"\"Сравнивает текущий скриншот с эталонным\"\"\"\n        if is_screenshots_update():\n            self.capture_screenshot(name, full_page)\n            pytest.skip(\"Updating reference screenshots\")\n    \n        reference_path = os.path.join(\n            self.reference_dir, self._get_filename(name, \"reference\"))\n        actual_path = os.path.join(\n            self.actual_dir, self._get_filename(name, \"actual\"))\n        diff_path = os.path.join(\n            self.diff_dir, self._get_filename(name, \"diff\"))\n    \n        # Делаем текущий скриншот\n        page.screenshot(path=actual_path, full_page=full_page)\n        allure.attach.file(actual_path, name=\"Actual: \" + name,\n                           attachment_type=AttachmentType.PNG)\n    \n        # Проверяем существование эталонного скриншота\n        if not os.path.exists(reference_path):\n            pytest.fail(\n                f\"Reference screenshot not found: {reference_path}\")\n    \n        # Загружаем изображения для сравнения\n        img_ref = Image.open(reference_path)\n        img_actual = Image.open(actual_path)\n        allure.attach.file(reference_path, name=\"Reference: \" + name,\n                           attachment_type=AttachmentType.PNG)\n    \n        # Проверяем совпадение размеров\n        if img_ref.size != img_actual.size:\n            pytest.fail(\n                f\"Screenshot sizes differ: {img_ref.size} vs {img_actual.size}\")\n    \n        # Сравниваем изображения\n        diff_img = Image.new(\"RGBA\", img_ref.size)\n        mismatch = pixelmatch(\n            img_ref,\n            img_actual,\n            diff_img,\n            threshold=threshold,\n            includeAA=False\n        )\n    \n        # Если есть различия - сохраняем diff\n        if mismatch > 0:\n            diff_img.save(diff_path)\n            allure.attach.file(diff_path, name=\"Diff: \" + name,\n                               attachment_type=AttachmentType.PNG)\n>           pytest.fail(f\"Screenshots differ by {mismatch} pixels\")\nE           Failed: Screenshots differ by 284 pixels\n\nconftest.py:139: Failed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"pytestconfig","time":{"start":1752372744455,"stop":1752372744455,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"base_url","time":{"start":1752372744455,"stop":1752372744455,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_verify_url","time":{"start":1752372744455,"stop":1752372744455,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"playwright","time":{"start":1752372744455,"stop":1752372744671,"duration":216},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"delete_output_dir","time":{"start":1752372744455,"stop":1752372744455,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"launch_browser","time":{"start":1752372744672,"stop":1752372744672,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_type","time":{"start":1752372744672,"stop":1752372744672,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser","time":{"start":1752372744672,"stop":1752372744925,"duration":253},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_type_launch_args","time":{"start":1752372744672,"stop":1752372744672,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"device","time":{"start":1752372744926,"stop":1752372744926,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_context_args","time":{"start":1752372744926,"stop":1752372744926,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_pw_artifacts_folder","time":{"start":1752372744926,"stop":1752372744926,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_artifacts_recorder","time":{"start":1752372839886,"stop":1752372839886,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"new_context","time":{"start":1752372839886,"stop":1752372839886,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"context","time":{"start":1752372839887,"stop":1752372839892,"duration":5},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"page","time":{"start":1752372839892,"stop":1752372839923,"duration":31},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"screenshot_helper","time":{"start":1752372839923,"stop":1752372839924,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"scrolled_page","time":{"start":1752372839924,"stop":1752372839924,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"status":"failed","statusMessage":"Failed: Screenshots differ by 284 pixels","statusTrace":"screenshot_helper = <conftest.screenshot_helper.<locals>.ScreenshotHelper object at 0x7f05a6417370>\npage = <Page url='https://klinika-innomed.ru/'>\nscrolled_page = <function scrolled_page.<locals>._scrolled_page at 0x7f05a66d3b50>\n\n    def test_homepage(screenshot_helper, page, scrolled_page):\n    \n        slider = \"\"\"\n            document.querySelectorAll('.owl-carousel').forEach(el => {\n                $(el).trigger('stop.owl.autoplay');\n            });\n            \"\"\"\n    \n        widgets_selectors = [\n            \"//div[@class='medflex-round-widget']\",\n            \"//div[contains(@class,'b24-widget-button-wrapper')]\"\n        ]\n    \n        # Загрузка + прокрутка вниз + удаление виджетов и остановка слайдера\n        scrolled_page(\"https://klinika-innomed.ru/\",\n                      slider_stop=slider, widgets_delete=widgets_selectors)\n    \n>       screenshot_helper.take_and_compare(\"homepage\")\n\nklinika-innomed.ru/test_klinika_innomed.py:21: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <conftest.screenshot_helper.<locals>.ScreenshotHelper object at 0x7f05a6417370>\nname = 'homepage', full_page = True, threshold = 0.1\n\n    def take_and_compare(self, name: str, full_page=True, threshold=0.1):\n        \"\"\"Сравнивает текущий скриншот с эталонным\"\"\"\n        if is_screenshots_update():\n            self.capture_screenshot(name, full_page)\n            pytest.skip(\"Updating reference screenshots\")\n    \n        reference_path = os.path.join(\n            self.reference_dir, self._get_filename(name, \"reference\"))\n        actual_path = os.path.join(\n            self.actual_dir, self._get_filename(name, \"actual\"))\n        diff_path = os.path.join(\n            self.diff_dir, self._get_filename(name, \"diff\"))\n    \n        # Делаем текущий скриншот\n        page.screenshot(path=actual_path, full_page=full_page)\n        allure.attach.file(actual_path, name=\"Actual: \" + name,\n                           attachment_type=AttachmentType.PNG)\n    \n        # Проверяем существование эталонного скриншота\n        if not os.path.exists(reference_path):\n            pytest.fail(\n                f\"Reference screenshot not found: {reference_path}\")\n    \n        # Загружаем изображения для сравнения\n        img_ref = Image.open(reference_path)\n        img_actual = Image.open(actual_path)\n        allure.attach.file(reference_path, name=\"Reference: \" + name,\n                           attachment_type=AttachmentType.PNG)\n    \n        # Проверяем совпадение размеров\n        if img_ref.size != img_actual.size:\n            pytest.fail(\n                f\"Screenshot sizes differ: {img_ref.size} vs {img_actual.size}\")\n    \n        # Сравниваем изображения\n        diff_img = Image.new(\"RGBA\", img_ref.size)\n        mismatch = pixelmatch(\n            img_ref,\n            img_actual,\n            diff_img,\n            threshold=threshold,\n            includeAA=False\n        )\n    \n        # Если есть различия - сохраняем diff\n        if mismatch > 0:\n            diff_img.save(diff_path)\n            allure.attach.file(diff_path, name=\"Diff: \" + name,\n                               attachment_type=AttachmentType.PNG)\n>           pytest.fail(f\"Screenshots differ by {mismatch} pixels\")\nE           Failed: Screenshots differ by 284 pixels\n\nconftest.py:139: Failed","steps":[],"attachments":[{"uid":"b1002555e93e38bf","name":"Actual: homepage","source":"b1002555e93e38bf.png","type":"image/png","size":2118524},{"uid":"f248a9bc6ffbb06d","name":"Reference: homepage","source":"f248a9bc6ffbb06d.png","type":"image/png","size":2118684},{"uid":"43041d17e02d2b7d","name":"Diff: homepage","source":"43041d17e02d2b7d.png","type":"image/png","size":715247}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":3,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"new_context::0","time":{"start":1752372909509,"stop":1752372909524,"duration":15},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_artifacts_recorder::0","time":{"start":1752372909524,"stop":1752372909524,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser::0","time":{"start":1752373032579,"stop":1752373032622,"duration":43},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_pw_artifacts_folder::0","time":{"start":1752373032579,"stop":1752373032579,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"playwright::0","time":{"start":1752373032624,"stop":1752373032631,"duration":7},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"parentSuite","value":"klinika-innomed.ru"},{"name":"suite","value":"test_klinika_innomed"},{"name":"host","value":"pkrvmq0rgcvqdmg"},{"name":"thread","value":"6496-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"klinika-innomed.ru.test_klinika_innomed"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"browser_name","value":"'chromium'"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"tags":[]},"source":"812c749822724ffa.json","parameterValues":["'chromium'"]}