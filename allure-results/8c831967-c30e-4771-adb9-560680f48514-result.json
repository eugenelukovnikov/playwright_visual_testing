{"name": "test_homepage[chromium]", "status": "failed", "statusDetails": {"message": "Failed: Screenshots differ by 18694 pixels", "trace": "screenshot_helper = <conftest.screenshot_helper.<locals>.ScreenshotHelper object at 0x7f9a11eb2400>, page = <Page url='https://river-travel.ru/'>\n\n    def test_homepage(screenshot_helper, page):\n        page.goto(\"https://river-travel.ru\")\n>       screenshot_helper.take_and_compare(\"homepage\")\n\nriver-travel.ru/test_river_travel.py:5: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <conftest.screenshot_helper.<locals>.ScreenshotHelper object at 0x7f9a11eb2400>, name = 'homepage', full_page = True, threshold = 0.1\n\n    def take_and_compare(self, name: str, full_page=True, threshold=0.1):\n        reference_filename = self._get_filename(name, \"reference\")\n        actual_filename = self._get_filename(name, \"actual\")\n        diff_filename = self._get_filename(name, \"diff\")\n    \n        reference_path = os.path.join(self.reference_dir, reference_filename)\n        actual_path = os.path.join(self.actual_dir, actual_filename)\n        diff_path = os.path.join(self.diff_dir, diff_filename)\n    \n        # Делаем актуальный скриншот\n        page.screenshot(path=actual_path, full_page=full_page)\n    \n        # Прикрепляем actual скриншот к отчету Allure\n        allure.attach.file(actual_path, name=\"Actual screenshot\",\n                         attachment_type=AttachmentType.PNG)\n    \n        # Если нет эталонного - сохраняем актуальный как эталонный\n        if not os.path.exists(reference_path):\n            page.screenshot(path=reference_path, full_page=full_page)\n            allure.attach.file(reference_path, name=\"Reference screenshot (created)\",\n                             attachment_type=AttachmentType.PNG)\n            pytest.skip(f\"Reference screenshot created: {reference_path}\")\n            return True\n    \n        # Прикрепляем reference скриншот к отчету Allure\n        allure.attach.file(reference_path, name=\"Reference screenshot\",\n                         attachment_type=AttachmentType.PNG)\n    \n        # Сравниваем изображения\n        img_ref = Image.open(reference_path)\n        img_actual = Image.open(actual_path)\n    \n        if img_ref.size != img_actual.size:\n            allure.attach(\"Screenshot sizes differ\", name=\"Comparison error\")\n            raise ValueError(f\"Screenshot sizes differ: {img_ref.size} vs {img_actual.size}\")\n    \n        # Быстрая проверка без создания diff\n        mismatch = pixelmatch(img_ref, img_actual, None, threshold=threshold, includeAA=True)\n    \n        # Если есть различия - создаем и прикрепляем diff\n        if mismatch > 0:\n            diff_img = Image.new(\"RGBA\", img_ref.size)\n            pixelmatch(img_ref, img_actual, diff_img, threshold=threshold, includeAA=True)\n            diff_img.save(diff_path)\n    \n            # Прикрепляем diff изображение к отчету Allure\n            allure.attach.file(diff_path, name=\"Difference highlight\",\n                             attachment_type=AttachmentType.PNG)\n    \n            # Добавляем текстовую информацию о различиях\n            allure.attach(f\"Found {mismatch} differing pixels (threshold: {threshold})\",\n                        name=\"Difference details\")\n    \n>           pytest.fail(f\"Screenshots differ by {mismatch} pixels\")\nE           Failed: Screenshots differ by 18694 pixels\n\nconftest.py:90: Failed"}, "attachments": [{"name": "Actual screenshot", "source": "5dd3ba55-b096-4d20-9cf9-60544f6bcdff-attachment.png", "type": "image/png"}, {"name": "Reference screenshot", "source": "6faeae36-d37d-4fb3-b18f-58a896811cc6-attachment.png", "type": "image/png"}, {"name": "Difference highlight", "source": "c21584d8-c2fd-4ae6-9edd-5fce13b9366d-attachment.png", "type": "image/png"}, {"name": "Difference details", "source": "22f89887-08e6-4b43-945c-9e32628e6d4c-attachment.attach"}], "parameters": [{"name": "browser_name", "value": "'chromium'"}], "start": 1748377990492, "stop": 1748378115943, "uuid": "7c273299-4093-426a-b2be-b31a7a10fc94", "historyId": "1bf6f2a94369588780dbc47851d0b8af", "testCaseId": "41f85ffe570457442eef359916025c9d", "fullName": "river-travel.ru.test_river_travel#test_homepage", "labels": [{"name": "parentSuite", "value": "river-travel.ru"}, {"name": "suite", "value": "test_river_travel"}, {"name": "host", "value": "yfy5pf"}, {"name": "thread", "value": "23583-MainThread"}, {"name": "framework", "value": "pytest"}, {"name": "language", "value": "cpython3"}, {"name": "package", "value": "river-travel.ru.test_river_travel"}]}